{% macro create(prefix='', type='basic', itemFields="") %}


<div class="sheet-item-card sheet-type-{{type}}">
    {{ outputField(field=itemFields.name, prefix=prefix, itemFields=itemFields)}}
    <div class="sheet-item-header">
        {% for fld in itemFields.general %}
            {{ outputField(field=fld, prefix=prefix, itemFields=itemFields)}}
        {% endfor %}
    </div>

    <div class="sheet-item-body-section">
        {% for type in itemFields.itemTypes %}
            <input class="sheet-hidden sheet-item-type-{{type.value}}" type="checkbox" name="attr_{{prefix}}_{{itemFields.general[0].attr_name}}" value="{{type.value}}" {{"checked" if itemFields.general[0].default == type.value }} />
        {% endfor %}
        <div class="sheet-equipment-fields">
            {% for fld in itemFields.equipment %}
                {{ outputField(field=fld, prefix=prefix, itemFields=itemFields)}}
            {% endfor %}
        </div>
        <div class="sheet-melee-fields">
            {% for fld in itemFields.melee %}
                {{ outputField(field=fld, prefix=prefix, itemFields=itemFields)}}
            {% endfor %}
        </div>
        <div class="sheet-ranged-fields">
            {% for fld in itemFields.ranged %}
                {{ outputField(field=fld, prefix=prefix, itemFields=itemFields)}}
            {% endfor %}
        </div>
    </div>
</div>

{% endmacro %}



{% macro outputField(field='', prefix='', itemFields='') %}
    {% if prefix %}
        {% set attrName = ["attr_", prefix, "_", field.attr_name] %}
    {% else %}
        {% set attrName = ["attr_", field.attr_name] %}
    {% endif %}

    <div class="sheet-hidden">

        {# looped fields aren't supposed to output a field without a num #}
        {% if field.looped %}
            {% for num in range(0,field.count) %}
            <input type="hidden" name="{{ attrName | join}}_{{num}}" />

            {% if field.has_mod %}
            <input type="hidden" name="{{ attrName | join}}_{{num}}_mod" />
            {% endif %}

            {% endfor %}
        
        {% else %}
            <input type="hidden" name="{{ attrName | join}}" />

            {% if field.type == "max" %}
                <input type="hidden" name="{{ attrName | join}}_max" />
            {% endif %}
        {% endif %}
    </div>

{% endmacro %}

{% macro outputField(field='', prefix='', itemFields='') %}
    {% switch field.type %}
        {% case "text" %}
            {{ createText(field=field, prefix=prefix, itemFields=itemFields) }}
        {% case "textarea" %}
            {{ createTextarea(field=field, prefix=prefix, itemFields=itemFields) }}
        {% case "text_number" %}
            {{ createTextNumber(field=field, prefix=prefix, itemFields=itemFields) }}
        {% case "line_text" %}
            {{ createLineText(field=field, prefix=prefix, itemFields=itemFields) }}
        {% case "line_number" %}
            {{ createLineNumber(field=field, prefix=prefix, itemFields=itemFields) }}
        {% case "max" %}
            {{ createMax(field=field, prefix=prefix, itemFields=itemFields) }}
        {% case "select" %}
            {{ createSelect(field=field, prefix=prefix, itemFields=itemFields) }}
        {% case "select_stat_repeater" %}
            {{ createSelectStatRepeater(field=field, prefix=prefix, itemFields=itemFields) }}
    {% endswitch %}
{% endmacro %}


{# text #}
{% macro createText(field='', prefix='', itemFields='') %}
    {% if prefix %}
        {% set attrName = ["attr_", prefix, "_", field.attr_name] %}
    {% else %}
        {% set attrName = ["attr_", field.attr_name] %}
    {% endif %}

    <div class="sheet-item-field">
        <div class="sheet-header">
            {{ field.display_name }}
        </div>
        <div class="sheet-field">
            <input type="text" name="{{attrName | join}}"></input>
        </div>
    </div>
{% endmacro %}

{# textarea #}
{% macro createTextarea(field='', prefix='', itemFields='') %}
    {% if prefix %}
        {% set attrName = ["attr_", prefix, "_", field.attr_name] %}
    {% else %}
        {% set attrName = ["attr_", field.attr_name] %}
    {% endif %}

    <div class="sheet-item-field">
        <div class="sheet-header">
            {{ field.display_name }}
        </div>
        <div class="sheet-field">
            <textarea class="sheet-line-height" name="{{attrName | join}}"/>
        </div>
    </div>
{% endmacro %}


{# text_number #}
{% macro createTextNumber(field='', prefix='', itemFields='') %}
    {% if prefix %}
        {% set attrName = ["attr_", prefix, "_", field.attr_name] %}
    {% else %}
        {% set attrName = ["attr_", field.attr_name] %}
    {% endif %}

    <div class="sheet-item-field">
        <div class="sheet-header">
            {{ field.display_name }}
        </div>
        <div class="sheet-field">
            <input class="sheet-number" type="text" name="{{attrName | join}}"></input>
        </div>
    </div>
{% endmacro %}




{# line_text #}
{% macro createLineText(field='', prefix='', itemFields='') %}
    {% if prefix %}
        {% set attrName = ["attr_", prefix, "_", field.attr_name] %}
    {% else %}
        {% set attrName = ["attr_", field.attr_name] %}
    {% endif %}

    <div class="sheet-item-field sheet-line-field">
        <div class="sheet-header">
            {{ field.display_name }}
        </div>
        <div class="sheet-field">
            <input class="sheet-line-input" type="text" name="{{attrName | join}}"></input>
        </div>
    </div>
{% endmacro %}


{# line_number #}
{% macro createLineNumber(field='', prefix='', itemFields='') %}
    {% if prefix %}
        {% set attrName = ["attr_", prefix, "_", field.attr_name] %}
    {% else %}
        {% set attrName = ["attr_", field.attr_name] %}
    {% endif %}

    <div class="sheet-item-field sheet-line-field">
        <div class="sheet-header">
            {{ field.display_name }}
        </div>
        <div class="sheet-field">
            <input class="sheet-line-input sheet-number" type="text" name="{{attrName | join}}"></input>
        </div>
    </div>
{% endmacro %}

{# max #}
{% macro createMax(field='', prefix='', itemFields='') %}
    {% if prefix %}
        {% set attrName = ["attr_", prefix, "_", field.attr_name] %}
    {% else %}
        {% set attrName = ["attr_", field.attr_name] %}
    {% endif %}

    <div class="sheet-item-field sheet-line-field">
        <div class="sheet-header">
            {{ field.display_name }}
        </div>
        <div class="sheet-field sheet-has-max">
            <input class="sheet-line-input sheet-number" type="text" name="{{attrName | join}}"></input>
            <div class="sheet-divider">/</div>
            <input class="sheet-line-input sheet-number" type="text" name="{{attrName | join}}_max"></input>
        </div>
    </div>
{% endmacro %}


{# select #}
{% macro createSelect(field='', prefix='', itemFields='') %}
    {% if prefix %}
        {% set attrName = ["attr_", prefix, "_", field.attr_name] %}
    {% else %}
        {% set attrName = ["attr_", field.attr_name] %}
    {% endif %}

    {% switch field.options %}
        {% case "itemTypes" %}
            {% set selectOptions = itemFields.itemTypes %}
        {% case "ammoTypes" %}
            {% set selectOptions = itemFields.ammoTypes %}
        {% default %}
            {% set selectOptions = [] %}
    {% endswitch %}


    <div class="sheet-item-field">
        <div class="sheet-header">
            {{ field.display_name }}
        </div>
        <div class="sheet-field sheet-has-max">
            <select name="{{attrName | join}}" value="{{field.default}}">
                {% for option in selectOptions %}
                <option value="{{option.value}}">{{option.name}}</option>
                {% endfor %}
            </select>
        </div>
    </div>
{% endmacro %}

{# select and stat repeater #}
{% macro createSelectStatRepeater(field='', prefix='', itemFields='') %}
    {% if prefix %}
        {% set attrName = ["attr_", prefix, "_", field.attr_name] %}
    {% else %}
        {% set attrName = ["attr_", field.attr_name] %}
    {% endif %}

    {% switch field.options %}
        {% case "itemTypes" %}
            {% set selectOptions = itemFields.itemTypes %}
        {% case "ammoTypes" %}
            {% set selectOptions = itemFields.ammoTypes %}
        {% default %}
            {% set selectOptions = [] %}
    {% endswitch %}


    <div class="sheet-item-field sheet-stat-repeater">
        <div class="sheet-header">
            {{ field.display_name }}
        </div>
        <div class="sheet-field sheet-stat-repeater">
            {% for num in range(0,field.count) %}
                {% set toJoin = ["attr_", prefix, "_", field.attr_name, "_", num] %}
                {% set newAttr = toJoin | join %}

                <div class="sheet-stat-item">
                    <div class="sheet-stat-select">
                        <select name="{{newAttr}}">
                            <option value="" default></option>
                            {# a custom made array of options #}
                            {% for val in options %}
                                <option value="{{val.value}}">{{val.name}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="sheet-stat-mod">
                        {% set modJoin = [newAttr, "_mod"] %}
                        <input class="sheet-line-input sheet-number" type="text" name="{{ modJoin | join}}"></input>
                    </div>
                </div>

            {% endfor %}
        </div>
    </div>
{% endmacro %}



